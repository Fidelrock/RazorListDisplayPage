@page
@model RazorTableDemo.Pages.ETIMSEntityAttributeModel
@{
    ViewData["Title"] = "ETIMS Entity Attributes";
}

<div class="container-fluid p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold">@ViewData["Title"]</h4>
        <button class="btn btn-teal px-4" id="backButton"><i class="fas fa-arrow-left me-2"></i>BACK</button>
    </div>

    <!-- Page Loading Overlay -->
    <div id="pageLoadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner-border text-teal" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-teal">Loading data...</p>
        </div>
    </div>

    <div class="card mb-3 p-3">
        <form method="get" class="row g-3 align-items-end" id="searchForm">
            <div class="col-md-4">
                <label class="form-label">Entity Type:</label>
                <input asp-for="EntityType" type="text" class="form-control" placeholder="Enter entity type" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Search Key:</label>
                <input asp-for="SearchKey" type="text" class="form-control" placeholder="Enter search key" />
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-teal" id="searchButton">
                    <span class="button-text"><i class="fas fa-search me-2"></i>SEARCH</span>
                    <span class="button-loading" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        Searching...
                    </span>
                </button>
            </div>
        </form>
    </div>

    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="alert alert-success d-flex align-items-center py-2 mb-3" role="alert" style="max-width:600px;">
            <i class="fas fa-check-circle me-2"></i>
            <span>@Model.SuccessMessage</span>
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger d-flex align-items-center py-2 mb-3" role="alert" style="max-width:600px;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span>@Model.ErrorMessage</span>
        </div>
    }

    <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">ETIMS Entity Attributes</h5>
            <div class="d-flex gap-2 align-items-center">
                <!-- Page Size Selector -->
                <div class="d-flex align-items-center me-3">
                    <label class="form-label me-2 mb-0">Show:</label>
                    <select class="form-select form-select-sm page-size-selector" id="pageSizeSelector">
                        <option value="5" selected="@(Model.PageSize == 5)">5</option>
                        <option value="10" selected="@(Model.PageSize == 10)">10</option>
                        <option value="25" selected="@(Model.PageSize == 25)">25</option>
                        <option value="50" selected="@(Model.PageSize == 50)">50</option>
                    </select>
                </div>
                <button class="btn btn-sm btn-outline-primary" id="refreshButton">
                    <span class="button-text"><i class="fas fa-refresh me-1"></i>Refresh</span>
                    <span class="button-loading" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                    </span>
                </button>
                <button class="btn btn-sm btn-outline-success" id="exportButton">
                    <span class="button-text"><i class="fas fa-download me-1"></i>Export</span>
                    <span class="button-loading" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                    </span>
                </button>
            </div>
        </div>

        <div id="tableContainer" class="table-container">
            <table class="table table-bordered table-striped align-middle mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>Client Code</th>
                        <th>Attribute ID</th>
                        <th>Entity Type</th>
                        <th>Search Key</th>
                        <th>Entity Key</th>
                        <th>Title</th>
                        <th>Extra Key</th>
                        <th>Extra Value</th>
                        <th>Sort Order</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Results != null && Model.Results.Any())
                    {
                        foreach (var item in Model.Results)
                        {
                            <tr>
                                <td>@item.ClientCode</td>
                                <td>@item.AttributeID</td>
                                <td>@item.EntityType</td>
                                <td>@item.SearchKey</td>
                                <td>@item.EntityKey</td>
                                <td>@item.Title</td>
                                <td>@(item.ExtraKey ?? "N/A")</td>
                                <td>@(item.ExtraValue ?? "N/A")</td>
                                <td>@item.SortOrder</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: @(Model.Results != null && !Model.Results.Any() ? "block" : "none");">
            <i class="fas fa-inbox"></i>
            <p>No ETIMS entity attributes found</p>
        </div>
        
        <!-- Pagination Info and Controls -->
        @if (Model.Results != null && Model.Results.Any())
        {
            <div class="d-flex justify-content-between align-items-center mt-3">
                <!-- Pagination Info -->
                <div class="text-muted">
                    Showing @((Model.CurrentPage - 1) * Model.PageSize + 1) to @Math.Min(Model.CurrentPage * Model.PageSize, Model.TotalCount) of @Model.TotalCount entries
                </div>
                
                <!-- Pagination Controls -->
                <nav aria-label="ETIMS entity attributes pagination">
                    <ul class="pagination pagination-sm mb-0">
                        <!-- First Page -->
                        <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                            <a class="page-link" href="?Page=1&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.EntityType) ? "" : "&EntityType=" + Model.EntityType)@(string.IsNullOrEmpty(Model.SearchKey) ? "" : "&SearchKey=" + Model.SearchKey)" aria-label="First">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                        </li>
                        
                        <!-- Previous Page -->
                        <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                            <a class="page-link" href="?Page=@(Model.CurrentPage - 1)&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.EntityType) ? "" : "&EntityType=" + Model.EntityType)@(string.IsNullOrEmpty(Model.SearchKey) ? "" : "&SearchKey=" + Model.SearchKey)" aria-label="Previous">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>
                        
                        <!-- Page Numbers -->
                        @{
                            var startPage = Math.Max(1, Model.CurrentPage - 2);
                            var endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
                        }
                        
                        @if (startPage > 1)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                        
                        @for (int i = startPage; i <= endPage; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link" href="?Page=@i&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.EntityType) ? "" : "&EntityType=" + Model.EntityType)@(string.IsNullOrEmpty(Model.SearchKey) ? "" : "&SearchKey=" + Model.SearchKey)">@i</a>
                            </li>
                        }
                        
                        @if (endPage < Model.TotalPages)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                        
                        <!-- Next Page -->
                        <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                            <a class="page-link" href="?Page=@(Model.CurrentPage + 1)&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.EntityType) ? "" : "&EntityType=" + Model.EntityType)@(string.IsNullOrEmpty(Model.SearchKey) ? "" : "&SearchKey=" + Model.SearchKey)" aria-label="Next">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        
                        <!-- Last Page -->
                        <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                            <a class="page-link" href="?Page=@Model.TotalPages&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.EntityType) ? "" : "&EntityType=" + Model.EntityType)@(string.IsNullOrEmpty(Model.SearchKey) ? "" : "&SearchKey=" + Model.SearchKey)" aria-label="Last">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        }
    </div>
</div>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Custom Pagination and Table Styles -->
<link rel="stylesheet" href="~/css/pagination-styles.css">

<!-- Custom Pagination and Loading Utilities -->
<script src="~/js/pagination-utils.js"></script>
