@page
@model UserProfileDisplayModel
@{
    ViewData["Title"] = "Demo Display Page";
}

<div class="container-fluid p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold">@ViewData["Title"]</h4>
        <button class="btn btn-teal px-4" id="backButton"><i class="fas fa-arrow-left me-2"></i>BACK</button>
    </div>

    <!-- Page Loading Overlay -->
    <div id="pageLoadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner-border text-teal" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-teal">Loading data...</p>
        </div>
    </div>

    <div class="card mb-3 p-3">
        <form method="get" class="row g-3 align-items-end" id="searchForm">
            <div class="col-md-3">
                <label class="form-label">Client Code:</label>
                <input asp-for="ClientCode" type="text" class="form-control" placeholder="CARLTD" />
            </div>
            <div class="col-md-3">
                <label class="form-label">Authority Key:</label>
                <input asp-for="AuthorityKey" type="text" class="form-control" />
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-teal w-100" id="searchButton">
                    <span class="button-text"><i class="fas fa-search me-2"></i>SEARCH</span>
                    <span class="button-loading" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        Searching...
                    </span>
                </button>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="button" class="btn btn-outline-secondary w-100" id="ajaxSearchButton">
                    <span class="button-text"><i class="fas fa-sync-alt me-2"></i>AJAX SEARCH</span>
                    <span class="button-loading" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        Loading...
                    </span>
                </button>
            </div>
        </form>
    </div>

    <!-- Progress Bar for AJAX Operations -->
    <div id="progressContainer" class="progress mb-3" style="display: none;">
        <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-teal" 
             role="progressbar" style="width: 0%"></div>
    </div>

    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="alert alert-success d-flex align-items-center py-2 mb-3" role="alert" style="max-width:600px;">
            <i class="fas fa-check-circle me-2"></i>
            <span>@Model.SuccessMessage</span>
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger d-flex align-items-center py-2 mb-3" role="alert" style="max-width:600px;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span>@Model.ErrorMessage</span>
        </div>
    }

    <!-- Error Alert for AJAX -->
    <div id="errorAlert" class="alert alert-danger d-flex align-items-center py-2 mb-3" role="alert" style="display: none; max-width:600px;">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span id="errorMessage"></span>
    </div>

    <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Tax Authorities</h5>
            <div class="d-flex gap-2 align-items-center">
                <!-- Page Size Selector -->
                <div class="d-flex align-items-center me-3">
                    <label class="form-label me-2 mb-0">Show:</label>
                    <select class="form-select form-select-sm page-size-selector" id="pageSizeSelector">
                        <option value="5" selected="@(Model.PageSize == 5)">5</option>
                        <option value="10" selected="@(Model.PageSize == 10)">10</option>
                        <option value="25" selected="@(Model.PageSize == 25)">25</option>
                        <option value="50" selected="@(Model.PageSize == 50)">50</option>
                    </select>
                    <button type="button" class="btn btn-sm btn-outline-info ms-2" onclick="testPageSizeSelector()">Test</button>
                </div>
                <button class="btn btn-sm btn-outline-primary" id="refreshButton">
                    <span class="button-text"><i class="fas fa-refresh me-1"></i>Refresh</span>
                    <span class="button-loading" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                    </span>
                </button>
                <button class="btn btn-sm btn-outline-success" id="exportButton">
                    <span class="button-text"><i class="fas fa-download me-1"></i>Export</span>
                    <span class="button-loading" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                    </span>
                </button>
            </div>
        </div>

        <div id="tableContainer" class="table-container">
            <table class="table table-bordered table-striped align-middle mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>ClientCode</th>
                        <th>AuthorityKey</th>
                        <th>Currency</th>
                        <th>Active</th>
                        <th>TaxType</th>
                        <th>TaxBase</th>
                        <th>LastMaintained</th>
                        <th>CreatedOn</th>
                        <th>UpdatedOn</th>
                    </tr>
                </thead>
                <tbody id="resultsTableBody">
                    @if (Model.Results != null)
                    {
                        foreach (var row in Model.Results)
                        {
                            <tr>
                                <td>@row.ClientCode</td>
                                <td>@row.AuthorityKey</td>
                                <td>@row.Currency</td>
                                <td>@row.Active</td>
                                <td>@row.TaxType</td>
                                <td>@row.TaxBase</td>
                                <td>@row.LastMaintained.ToString("dd-MMM-yyyy")</td>
                                <td>@row.CreatedOn.ToString("dd-MMM-yyyy")</td>
                                <td>@(row.UpdatedOn.HasValue? row.UpdatedOn.Value.ToString("dd-MMM-yyyy") : "N/A")</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

        <!-- Table Loading Placeholder -->
        <div id="tableLoading" class="empty-state" style="display: none;">
            <div class="spinner-border text-teal" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading tax authorities...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <i class="fas fa-inbox"></i>
            <p>No tax authorities found</p>
        </div>
        
        <!-- Pagination Info and Controls -->
        @if (Model.Results != null && Model.Results.Any())
        {
            <div class="d-flex justify-content-between align-items-center mt-3">
                <!-- Pagination Info -->
                <div class="text-muted">
                    Showing @((Model.CurrentPage - 1) * Model.PageSize + 1) to @Math.Min(Model.CurrentPage * Model.PageSize, Model.TotalCount) of @Model.TotalCount entries
                </div>
                
                <!-- Pagination Controls -->
                <nav aria-label="Tax authorities pagination">
                    <ul class="pagination pagination-sm mb-0">
                        <!-- First Page -->
                        <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                            <a class="page-link" href="?Page=1&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.ClientCode) ? "" : "&ClientCode=" + Model.ClientCode)@(string.IsNullOrEmpty(Model.AuthorityKey) ? "" : "&AuthorityKey=" + Model.AuthorityKey)" aria-label="First">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                        </li>
                        
                        <!-- Previous Page -->
                        <li class="page-item @(Model.HasPreviousPage ? "" : "disabled")">
                            <a class="page-link" href="?Page=@(Model.CurrentPage - 1)&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.ClientCode) ? "" : "&ClientCode=" + Model.ClientCode)@(string.IsNullOrEmpty(Model.AuthorityKey) ? "" : "&AuthorityKey=" + Model.AuthorityKey)" aria-label="Previous">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>
                        
                        <!-- Page Numbers -->
                        @{
                            var startPage = Math.Max(1, Model.CurrentPage - 2);
                            var endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
                        }
                        
                        @if (startPage > 1)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                        
                        @for (int i = startPage; i <= endPage; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link" href="?Page=@i&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.ClientCode) ? "" : "&ClientCode=" + Model.ClientCode)@(string.IsNullOrEmpty(Model.AuthorityKey) ? "" : "&AuthorityKey=" + Model.AuthorityKey)">@i</a>
                            </li>
                        }
                        
                        @if (endPage < Model.TotalPages)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                        
                        <!-- Next Page -->
                        <li class="page-item @(Model.HasNextPage ? "" : "disabled")">
                            <a class="page-link" href="?Page=@(Model.CurrentPage + 1)&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.ClientCode) ? "" : "&ClientCode=" + Model.ClientCode)@(string.IsNullOrEmpty(Model.AuthorityKey) ? "" : "&AuthorityKey=" + Model.AuthorityKey)" aria-label="Next">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        
                        <!-- Last Page -->
                        <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                            <a class="page-link" href="?Page=@Model.TotalPages&PageSize=@Model.PageSize@(string.IsNullOrEmpty(Model.ClientCode) ? "" : "&ClientCode=" + Model.ClientCode)@(string.IsNullOrEmpty(Model.AuthorityKey) ? "" : "&AuthorityKey=" + Model.AuthorityKey)" aria-label="Last">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        }
    </div>
</div>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Custom Pagination and Table Styles -->
<link rel="stylesheet" href="~/css/pagination-styles.css">

<!-- Custom Pagination and Loading Utilities -->
<script src="~/js/pagination-utils.js"></script>

<script>
    // Page-specific customizations can go here
    // The main functionality is now handled by pagination-utils.js
    
    // Test function for page size selector (kept for backward compatibility)
    function testPageSizeSelector() {
        if (window.PaginationUtils && window.PaginationUtils.PageSizeManager) {
            window.PaginationUtils.PageSizeManager.test();
        } else {
            alert('Pagination utilities not loaded!');
        }
    }
</script>